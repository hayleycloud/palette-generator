function gplColor(e){let t=e.toString(),n=t.length;return 1==n?"  "+t:2==n?" "+t:t}function createGPLFile(e,t){let n="";return n+="GIMP Palette\n",n+="#\n",n+="# Generated by Hayley Hatton's Mathematical Palette Generator\n",n+="#\n",t.forEach((e,t)=>{n+=gplColor(e.r)+" ",n+=gplColor(e.g)+" ",n+=gplColor(e.b)+"	Index "+t+"\n"}),n}function downloadFile(e,t){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function downloadAsGPLFile(){let e=getColorsFrom(getSamplers());return downloadFile("test.gpl",createGPLFile("test.gpl",e)),!1}function saveBrowser(){}function loadBrowser(){}function spliceProperty(e){let t=e.indexOf(":"),n=e.substr(0,t),r=e.substr(t+1);return[n,r]}function saveLocal(){let e="V10\n",t=document.getElementById("pal-name");e+="name:"+t.value+"\n";let n=document.getElementById("max-colors");e+="size:"+n.value+"\n",getSamplers().forEach(t=>{e+=t.serialize()+"\n"}),downloadFile(t.value+".psf",e)}function loadLocal(e){let t=e.split("\n");if("V10"!=t[0]){alert("Version not supported!");return}let n=document.getElementById("pal-name");n.value=spliceProperty(t[1])[1];let r=document.getElementById("max-colors");r.value=spliceProperty(t[2])[1],resetSamplers();let a=t.splice(3);a.forEach(e=>{let[t,n]=spliceProperty(e),r=null;switch(t){case"LinearRGBSampler":r=LinearRGBSampler.deserialize(n);break;case"LinearSRGBSampler":r=LinearSRGBSampler.deserialize(n);break;case"BezierFastSampler":r=BezierFastSampler.deserialize(n);break;case"BezierQuadraticSampler":r=BezierQuadraticSampler.deserialize(n);break;case"HSVSampler":r=HSVSampler.deserialize(n);break;default:return}r._htmlID=genSamplerID(),getSamplers().push(r),addPropertyForExisting(r)}),syncPaletteView(),clampPropertyShiftBtns()}function createSettingsTable(){let e=document.createElement("table");e.id="settings";let t=document.createElement("thead"),n=document.createElement("tr"),r=document.createElement("th");r.textContent="Settings",r.colSpan=2;let a=document.createElement("tbody"),l=document.createElement("tr"),i=document.createElement("th");i.textContent="Name:";let s=document.createElement("td"),o=document.createElement("input");o.id="pal-name",o.type="text",o.value="My Palette",o.minLength=1,o.oninput=e=>{validate()},s.appendChild(o);let d=document.createElement("tr"),m=document.createElement("th");m.textContent="Max Palette Size:";let c=document.createElement("td"),p=document.createElement("input");p.id="max-colors",p.type="number",p.min="0",p.step="1",p.value="255",p.onchange=()=>{let e=parseInt(p.value);e=Math.max(e,parseInt(p.min)),p.value=e.toString(),validate()},c.appendChild(p);let u=document.createElement("tr"),h=document.createElement("th");h.textContent="Errors:";let E=document.createElement("td");return E.id="errors",E.className="errors-none",E.innerHTML='<span class="errors-none">No errors :)</span>',n.appendChild(r),t.appendChild(n),l.append(i,s),d.append(m,c),u.append(h,E),a.append(l,d,u),e.append(t,a),e}function createPaletteTable(e,t){let n=document.createElement("tbody"),r=Math.ceil(t.length/e);for(let a=0;a<r;a++){let l=document.createElement("tr"),i=a+1==r?t.length%e:e;0==i&&(i=e);for(let s=0;s<i;s++){let o=document.createElement("td"),d=a*e+s,m=t[d],c=rgb2str(m);o.style.backgroundColor=c,o.title=c+" (R: "+m.r+", G: "+m.g+", B: "+m.b+")",l.appendChild(o)}n.appendChild(l)}return n}function createPaletteView(e,t){let n=document.createElement("table");n.classList.add("palette-view"),n.id="palette-view";let r=document.createElement("thead"),a=document.createElement("tr"),l=document.createElement("th");l.textContent="Palette View",l.colSpan=e;let i=document.createElement("tr"),s=document.createElement("td");s.colSpan=e;let o=document.createElement("input");o.type="number",o.id="col-count",o.min="1",o.value=e.toString(),o.step="1",o.size=3,o.onchange=()=>{let e=parseInt(o.value);e=Math.max(e,parseInt(o.min)),o.value=e.toString(),syncPaletteView()};let d=document.createElement("label");d.htmlFor="col-count",d.textContent="Columns: ",s.append(d,o),i.appendChild(s);let m=document.createElement("tr"),c=document.createElement("td");c.colSpan=e;let p=document.createElement("input");p.type="number",p.id="color-count",p.value=t.length.toString(),p.step="1",p.size=5,p.readOnly=!0;let u=document.createElement("label");u.htmlFor="color-count",u.textContent="# Colors: ",c.append(u,p),m.appendChild(c);let h=createPaletteTable(e,t);return a.appendChild(l),r.append(a,i,m),n.appendChild(r),n.appendChild(h),n}function createNewPaletteViewFrom(e,t){let n=getColorsFrom(t),r=createPaletteView(e,n);return r}function updatePaletteViewFrom(e){let t=document.getElementById("col-count"),n=parseInt(t.value),r=document.getElementById("palette-view");r.remove();let a=document.getElementById("readout-section"),l=createNewPaletteViewFrom(n,e);a.appendChild(l)}function syncPaletteView(){updatePaletteViewFrom(getSamplers()),validate()}function clampPropertyShiftBtns(){let e=document.getElementById("properties"),t=e.children.length,n=e.children.length-1;if(0==t)return;let r=e.getElementsByClassName("shifter");for(let a=0;a<r.length;a++)r[a].disabled=!1;let l=e.children[0].getElementsByClassName("shift-up")[0],i=e.children[n].getElementsByClassName("shift-down")[0];l.disabled=!0,i.disabled=!0}function shiftPropertyUp(e){let t=document.getElementById("properties"),n=t.children.length-1,r=null;for(let a=0;a<t.children.length;a++){let l=t.children[a];if(r&&l.id==e){t.insertBefore(l,r);let i=getSamplers()[a-1],s=getSamplers()[a],o=a>1?getSamplers().splice(0,a-1):[],d=a<n?getSamplers().splice(a+1):[];setSamplers(o.concat(s).concat(i).concat(d)),syncPaletteView();break}r=l}clampPropertyShiftBtns()}function shiftPropertyDown(e){let t=document.getElementById("properties"),n=t.children.length-1,r=null;for(let a=n;a>=0;a--){let l=t.children[a];if(r&&l.id==e){t.insertBefore(r,l);let i=getSamplers()[a+1],s=getSamplers()[a],o=a>0?getSamplers().splice(0,a):[],d=a<n?getSamplers().splice(a+2):[];setSamplers(o.concat(i).concat(s).concat(d)),syncPaletteView();break}r=l}clampPropertyShiftBtns()}function addPropertyActionsTo(e,t,n){let r=document.createElement("button");r.classList.add("shifter","shift-up"),r.type="button",r.textContent="",r.onclick=()=>{shiftPropertyUp(t)};let a=document.createElement("button");a.classList.add("shifter","shift-down"),a.type="button",a.textContent="",a.onclick=()=>{shiftPropertyDown(t)};let l=document.createElement("a");l.classList.add("remover"),l.textContent="Remove",l.onclick=()=>{removeProperty(n)},e.children[2].append(r,document.createElement("br"),l,document.createElement("br"),a)}function addPropertyForExisting(e){let t=document.getElementById("properties"),n=e.createHTML();addPropertyActionsTo(n,"sampler-"+e.htmlID(),e.htmlID()),t.appendChild(n)}function addNewProperty(e){let t=document.getElementById("properties"),n=null;switch(e.value){case"linear":n=new LinearRGBSampler(genSamplerID());break;case"linear-srgb":n=new LinearSRGBSampler(genSamplerID());break;case"bezier-fast":n=new BezierFastSampler(genSamplerID());break;case"bezier-quad":n=new BezierQuadraticSampler(genSamplerID());break;case"hsv":n=new HSVSampler(genSamplerID())}let r=n.createHTML();addPropertyActionsTo(r,"sampler-"+n.htmlID(),n.htmlID()),t.appendChild(r),getSamplers().push(n),syncPaletteView(),clampPropertyShiftBtns()}function createAddNewProperty(){let e=document.createElement("tfoot"),t=document.createElement("tr"),n=[document.createElement("td"),document.createElement("td"),document.createElement("td")];n[0].textContent="Add New:",n[0].classList.add("pseudo-th");let r=document.createElement("select"),a=document.createElement("option");a.text="-- Select Mode --",a.disabled=!0,a.hidden=!0,a.selected=!0,r.add(a),[{name:"Linear Gradients",options:[{id:"linear",title:"Linear (RGB)"},{id:"linear-srgb",title:"Linear (sRGB)"}]},{name:"Exponential Gradients",options:[{id:"bezier-fast",title:"B\xe9zier (Fast)"},{id:"bezier-quad",title:"B\xe9zier"}]},{name:"Hue-Saturation-Value",options:[{id:"hsv",title:"HSV"}]}].forEach(e=>{let t=document.createElement("option");t.text=e.name,t.disabled=!0,r.add(t),e.options.forEach(e=>{let t=document.createElement("option");t.text=e.title,t.value=e.id,r.add(t)})}),n[1].appendChild(r);let l=document.createElement("button");return l.type="button",l.onclick=()=>{addNewProperty(r),r.selectedIndex=0,l.disabled=!0},l.textContent="Add",l.disabled=!0,r.onchange=()=>{l.disabled=!1},n[2].appendChild(l),t.append(n[0],n[1],n[2]),e.appendChild(t),e}function removeProperty(e){document.getElementById("sampler-"+e).remove(),getSamplers().forEach((t,n)=>{t.htmlID()==e&&getSamplers().splice(n,1)}),syncPaletteView()}function createPropertiesList(){let e=document.createElement("table");e.classList.add("properties-list");let t=document.createElement("thead"),n=document.createElement("tr"),r=[document.createElement("th"),document.createElement("th"),document.createElement("th")];r[0].textContent="Type",r[1].textContent="Parameters",r[2].textContent="Actions",n.append(r[0],r[1],r[2]),t.append(n);let a=document.createElement("tbody");a.id="properties",getSamplers().forEach(e=>{let t=e.createHTML();addPropertyActionsTo(t,e.id(),e.htmlID()),a.appendChild(t)});let l=createAddNewProperty();return e.append(t,a,l),e}function createFileOps(){let e=document.createElement("table");e.id="file-ops";let t=document.createElement("thead"),n=document.createElement("tr"),r=document.createElement("th");r.textContent="File",r.colSpan=2,n.appendChild(r),t.appendChild(n);let a=document.createElement("tbody"),l=[document.createElement("tr"),document.createElement("tr"),document.createElement("tr")],i=document.createElement("th"),s=document.createElement("td");i.textContent="Download Palette: ";let o=document.createElement("button");o.type="button",o.id="download-gpl",o.textContent="Download GPL",s.appendChild(o),l[0].append(i,s);let d=document.createElement("th"),m=document.createElement("td");d.textContent="Load Session: ";let c=document.createElement("input");c.type="file",c.accept=".psf",c.id="local-loader",c.addEventListener("change",e=>{c.files[0].text().then(e=>{loadLocal(e)})}),m.appendChild(c),l[1].append(d,m);let p=document.createElement("th"),u=document.createElement("td");p.textContent="Save Session: ";let h=document.createElement("button");return h.type="button",h.textContent="Save",h.onclick=saveLocal,u.appendChild(h),l[2].append(p,u),a.append(l[0],l[1],l[2]),e.append(t,a),e}function createReadoutSection(){let e=document.createElement("div");return e.classList.add("centered"),e.id="readout-section",e}function createInputSection(){let e=document.createElement("div");return e.id="input-section",e}function createPage(){let e=document.getElementById("app"),t=createSettingsTable();getSamplers().push(new LinearRGBSampler(genSamplerID()));let n=document.createElement("div"),r=createReadoutSection();r.appendChild(createNewPaletteViewFrom(8,getSamplers()));let a=createInputSection();a.appendChild(createPropertiesList()),n.append(r,a),e.append(t,n,createFileOps()),clampPropertyShiftBtns(),window.innerHeight>window.innerWidth?n.id="app-split-v":n.id="app-split-h",window.onresize=e=>{let t=window.innerHeight>window.innerWidth?"app-split-v":"app-split-h";n.id=t}}function setNoErrorState(){let e=document.getElementById("errors");e.className="errors-none",e.textContent="No errors :)";let t=document.getElementById("palette-view");t.classList.remove("bad-palette-view"),document.getElementById("download-gpl").disabled=!1}function setErrorState(){let e=document.getElementById("errors");e.className="errors-some";let t=document.getElementById("palette-view");t.classList.add("bad-palette-view"),document.getElementById("download-gpl").disabled=!0}function setErrors(e){if(e.length>0){setErrorState();let t=document.getElementById("errors");t.textContent=e.reduce((e,t)=>e+"\n"+t)}else setNoErrorState()}function validate(){let e=[],t=document.querySelectorAll("#palette-view > tbody > tr > td"),n=document.getElementById("max-colors"),r=parseInt(n.value);r>0&&t.length>r&&e.push("More colors than max palette size!");let a=document.getElementById("pal-name");-1!=a.value.search(/[\.\<\>\\\/\*]+$/g)&&(e.push("Invalid file name:"),e.push("Disallowed character.")),setErrors(e)}function onLoad(){createPage(),validate()}function rgb2str(e){let t=e.r.toString(16).toUpperCase();1==t.length&&(t="0"+t);let n=e.g.toString(16).toUpperCase();1==n.length&&(n="0"+n);let r=e.b.toString(16).toUpperCase();return 1==r.length&&(r="0"+r),"#"+t+n+r}function str2rgb(e){"#"==e[0]&&(e=e.substr(1));let t=3==e.length?1:2,n="0x"+e.substr(0,t),r="0x"+e.substr(t,t),a="0x"+e.substr(2*t,t);return{r:parseInt(n),g:parseInt(r),b:parseInt(a)}}function hsv2rgb(e){e.h<0?e.h=360+e.h:e.h>=360&&(e.h=0+(e.h-360));let t=.01*e.s*(.01*e.v),n=t*(1-Math.abs(e.h/60%2-1)),r=.01*e.v-t,a,l,i;return e.h>=0&&e.h<60?(a=t,l=n,i=0):e.h>=60&&e.h<120?(a=n,l=t,i=0):e.h>=120&&e.h<180?(a=0,l=t,i=n):e.h>=180&&e.h<240?(a=0,l=n,i=t):e.h>=240&&e.h<300?(a=n,l=0,i=t):e.h>=300&&e.h<360&&(a=t,l=0,i=n),{r:Math.round((a+r)*255),g:Math.round((l+r)*255),b:Math.round((i+r)*255)}}var g_samplers=[],g_accumulator=0;function generateColorsLerp(e,t,n){let r=(t.r-e.r)/(n-1),a=(t.g-e.g)/(n-1),l=(t.b-e.b)/(n-1),i=[];for(let s=0;s<n;s++)i.push({r:Math.round(e.r+r*s),g:Math.round(e.g+a*s),b:Math.round(e.b+l*s)});return i}class LinearRGBSampler{id(){return"linear"}htmlID(){return this._htmlID}constructor(e,t={r:0,g:0,b:0},n={r:255,g:255,b:255},r=16){this._htmlID=e,this.start=t,this.end=n,this.num=r}serialize(){return"LinearRGBSampler:"+JSON.stringify(this)}static deserialize(e){let t=JSON.parse(e);return new LinearRGBSampler(t._htmlID,t.start,t.end,t.num)}sample(){return generateColorsLerp(this.start,this.end,this.num)}createHTML(){let e="sampler-"+this._htmlID,t=document.createElement("tr");t.id=e;let n=[document.createElement("td"),document.createElement("td"),document.createElement("td")];n[0].innerHTML="Linear<br/><i>(RGB)</i>",n[0].classList.add("pseudo-th");let r=document.createElement("div");r.classList.add("parameters-list","parameters-list-linear");let a=[document.createElement("div"),document.createElement("div"),document.createElement("div")],l=e+"-start",i=document.createElement("input");i.type="color",i.id=l,i.value=rgb2str(this.start),i.onchange=()=>{this.start=str2rgb(i.value),syncPaletteView()};let s=document.createElement("label");s.htmlFor=l,s.textContent="Start:",a[0].append(s,document.createElement("br"),i);let o=e+"-end",d=document.createElement("input");d.type="color",d.id=o,d.value=rgb2str(this.end),d.onchange=()=>{this.end=str2rgb(d.value),syncPaletteView()};let m=document.createElement("label");m.htmlFor=o,m.textContent="End:",a[1].append(m,document.createElement("br"),d);let c=e+"-num",p=document.createElement("input");p.type="number",p.id=c,p.min="1",p.max="255",p.step="1",p.value=this.num.toString(),p.size=4,p.onchange=()=>{let e=parseInt(p.value);e=Math.min(e=Math.max(e,parseInt(p.min)),parseInt(p.max)),this.num=e,p.value=e.toString(),syncPaletteView()};let u=document.createElement("label");return u.htmlFor=c,u.textContent="Count:",a[2].append(u,document.createElement("br"),p),r.append(a[0],a[1],a[2]),n[1].appendChild(r),t.append(n[0],n[1],n[2]),t}}function linear2srgb(e){return e/=255,Math.round(255*(e=e**2.2))}class LinearSRGBSampler{id(){return"linear-srgb"}htmlID(){return this._htmlID}constructor(e,t={r:0,g:0,b:0},n={r:255,g:255,b:255},r=16){this._htmlID=e,this.start=t,this.end=n,this.num=r}serialize(){return"LinearSRGBSampler:"+JSON.stringify(this)}static deserialize(e){let t=JSON.parse(e);return new LinearSRGBSampler(t._htmlID,t.start,t.end,t.num)}sample(){let e=(this.end.r-this.start.r)/(this.num-1),t=(this.end.g-this.start.g)/(this.num-1),n=(this.end.b-this.start.b)/(this.num-1),r=[];for(let a=0;a<this.num;a++)r.push({r:linear2srgb(Math.round(this.start.r+e*a)),g:linear2srgb(Math.round(this.start.g+t*a)),b:linear2srgb(Math.round(this.start.b+n*a))});return r}createHTML(){let e="sampler-"+this._htmlID,t=document.createElement("tr");t.id=e;let n=[document.createElement("td"),document.createElement("td"),document.createElement("td")];n[0].innerHTML="Linear<br/><i>(sRGB)</i>",n[0].classList.add("pseudo-th");let r=document.createElement("div");r.classList.add("parameters-list","parameters-list-linear");let a=[document.createElement("div"),document.createElement("div"),document.createElement("div")],l=e+"-start",i=document.createElement("input");i.type="color",i.id=l,i.value=rgb2str(this.start),i.onchange=()=>{this.start=str2rgb(i.value),syncPaletteView()};let s=document.createElement("label");s.htmlFor=l,s.textContent="Start:",a[0].append(s,document.createElement("br"),i);let o=e+"-end",d=document.createElement("input");d.type="color",d.id=o,d.value=rgb2str(this.end),d.onchange=()=>{this.end=str2rgb(d.value),syncPaletteView()};let m=document.createElement("label");m.htmlFor=o,m.textContent="End:",a[1].append(m,document.createElement("br"),d);let c=e+"-num",p=document.createElement("input");p.type="number",p.id=c,p.min="1",p.max="255",p.step="1",p.value=this.num.toString(),p.size=4,p.onchange=()=>{let e=parseInt(p.value);e=Math.min(e=Math.max(e,parseInt(p.min)),parseInt(p.max)),this.num=e,p.value=e.toString(),syncPaletteView()};let u=document.createElement("label");return u.htmlFor=c,u.textContent="Count:",a[2].append(u,document.createElement("br"),p),r.append(a[0],a[1],a[2]),n[1].appendChild(r),t.append(n[0],n[1],n[2]),t}}function linear2quadbez_fast(e,t){return Math.round((2*(1-(e/=255))*e*t+e*e)*255)}class BezierFastSampler{id(){return"bezier-fast"}htmlID(){return this._htmlID}constructor(e,t={r:0,g:0,b:0},n={r:255,g:255,b:255},r=16,a=.25){this._htmlID=e,this.start=t,this.end=n,this.num=r,this.controlPoint=a}serialize(){return"BezierFastSampler:"+JSON.stringify(this)}static deserialize(e){let t=JSON.parse(e);return new BezierFastSampler(t._htmlID,t.start,t.end,t.num,t.controlPoint)}sample(){let e=generateColorsLerp(this.start,this.end,this.num),t=[];return e.forEach(e=>{t.push({r:linear2quadbez_fast(e.r,this.controlPoint),g:linear2quadbez_fast(e.g,this.controlPoint),b:linear2quadbez_fast(e.b,this.controlPoint)})}),t}createHTML(){let e="sampler-"+this._htmlID,t=document.createElement("tr");t.id=e;let n=[document.createElement("td"),document.createElement("td"),document.createElement("td")];n[0].innerHTML="B\xe9zier<br/><i>(Fast)</i>",n[0].classList.add("pseudo-th");let r=document.createElement("div");r.classList.add("parameters-list","parameters-list-bezier1");let a=[document.createElement("div"),document.createElement("div"),document.createElement("div"),document.createElement("div")],l=e+"-start",i=document.createElement("input");i.type="color",i.id=l,i.value=rgb2str(this.start),i.onchange=()=>{this.start=str2rgb(i.value),syncPaletteView()};let s=document.createElement("label");s.htmlFor=l,s.textContent="Start:",a[0].append(s,document.createElement("br"),i);let o=e+"-end",d=document.createElement("input");d.type="color",d.id=o,d.value=rgb2str(this.end),d.onchange=()=>{this.end=str2rgb(d.value),syncPaletteView()};let m=document.createElement("label");m.htmlFor=o,m.textContent="End:",a[1].append(m,document.createElement("br"),d);let c=e+"-num",p=document.createElement("input");p.type="number",p.id=c,p.min="1",p.max="255",p.step="1",p.value=this.num.toString(),p.size=4,p.onchange=()=>{let e=parseInt(p.value);e=Math.min(e=Math.max(e,parseInt(p.min)),parseInt(p.max)),this.num=e,p.value=e.toString(),syncPaletteView()};let u=document.createElement("label");u.htmlFor=c,u.textContent="Count:",a[2].append(u,document.createElement("br"),p);let h=e+"-cp",E=document.createElement("input");E.type="number",E.id=h,E.min="0.0",E.max="1.0",E.step="0.01",E.value=this.controlPoint.toString(),E.size=4,E.onchange=()=>{let e=parseFloat(E.value);e=Math.min(e=Math.max(e,parseFloat(E.min)),parseFloat(E.max)),this.controlPoint=e,E.value=e.toString(),syncPaletteView()};let g=document.createElement("label");return g.htmlFor=h,g.textContent="Control Point:",a[3].append(g,document.createElement("br"),E),r.append(a[0],a[1],a[2],a[3]),n[1].appendChild(r),t.append(n[0],n[1],n[2]),t}}function quadBezierEq(e,t){return 2*(1-e)*e*t+e*e}function quadBezierTFromX(e,t,n=.1,r=0,a=1e-4){let l=r,i=0;if(n<a)return r;for(;i<t;)r=l,l+=n,i=quadBezierEq(l,e);return quadBezierTFromX(e,t,.5*n,r)}function linear2quadbez(e,t){e/=255;let n=quadBezierTFromX(t[0],e),r=quadBezierEq(n,t[1]);return Math.round(255*r)}class BezierQuadraticSampler{id(){return"bezier-quad"}htmlID(){return this._htmlID}constructor(e,t={r:0,g:0,b:0},n={r:255,g:255,b:255},r=16,a=[.5,.15]){this._htmlID=e,this.start=t,this.end=n,this.num=r,this.controlPoint=a}serialize(){return"BezierQuadraticSampler:"+JSON.stringify(this)}static deserialize(e){let t=JSON.parse(e);return new BezierQuadraticSampler(t._htmlID,t.start,t.end,t.num,t.controlPoint)}sample(){let e=generateColorsLerp(this.start,this.end,this.num),t=[];return e.forEach(e=>{t.push({r:linear2quadbez(e.r,this.controlPoint),g:linear2quadbez(e.g,this.controlPoint),b:linear2quadbez(e.b,this.controlPoint)})}),t}createHTML(){let e="sampler-"+this._htmlID,t=document.createElement("tr");t.id=e;let n=[document.createElement("td"),document.createElement("td"),document.createElement("td")];n[0].innerHTML="B\xe9zier<br/><i>(Quadratic)</i>",n[0].classList.add("pseudo-th");let r=document.createElement("div");r.classList.add("parameters-list","parameters-list-bezier2");let a=[document.createElement("div"),document.createElement("div"),document.createElement("div"),document.createElement("div")],l=e+"-start",i=document.createElement("input");i.type="color",i.id=l,i.value=rgb2str(this.start),i.onchange=()=>{this.start=str2rgb(i.value),syncPaletteView()};let s=document.createElement("label");s.htmlFor=l,s.textContent="Start:",a[0].append(s,document.createElement("br"),i);let o=e+"-end",d=document.createElement("input");d.type="color",d.id=o,d.value=rgb2str(this.end),d.onchange=()=>{this.end=str2rgb(d.value),syncPaletteView()};let m=document.createElement("label");m.htmlFor=o,m.textContent="End:",a[1].append(m,document.createElement("br"),d);let c=e+"-num",p=document.createElement("input");p.type="number",p.id=c,p.min="1",p.max="255",p.step="1",p.value=this.num.toString(),p.size=4,p.onchange=()=>{let e=parseInt(p.value);e=Math.min(e=Math.max(e,parseInt(p.min)),parseInt(p.max)),this.num=e,p.value=e.toString(),syncPaletteView()};let u=document.createElement("label");u.htmlFor=c,u.textContent="Count:",a[2].append(u,document.createElement("br"),p);let h=document.createElement("input");h.type="number",h.id=e+"-cp-x",h.min="0.0",h.max="1.0",h.step="0.01",h.value=this.controlPoint[0].toString(),h.size=4,h.onchange=()=>{let e=parseFloat(h.value);e=Math.min(e=Math.max(e,parseFloat(h.min)),parseFloat(h.max)),this.controlPoint[0]=e,h.value=e.toString(),syncPaletteView()};let E=document.createElement("input");E.type="number",E.id=e+"-cp-y",E.min="0.0",E.max="1.0",E.step="0.01",E.value=this.controlPoint[1].toString(),E.size=4,E.onchange=()=>{let e=parseFloat(E.value);e=Math.min(e=Math.max(e,parseFloat(E.min)),parseFloat(E.max)),this.controlPoint[1]=e,E.value=e.toString(),syncPaletteView()};let g=document.createElement("label");return g.textContent="Control Point:",a[3].append(g,document.createElement("br"),h,E),r.append(a[0],a[1],a[2],a[3]),n[1].appendChild(r),t.append(n[0],n[1],n[2]),t}}class HSVSampler{id(){return"hsv"}htmlID(){return this._htmlID}constructor(e,t={h:0,s:100,v:100},n={h:360,s:30,v:30},r=8,a=3,l=3){this._htmlID=e,this.start=t,this.end=n,this.hueCount=r,this.satCount=a,this.valCount=l}serialize(){return"HSVSampler:"+JSON.stringify(this)}static deserialize(e){let t=JSON.parse(e);return new HSVSampler(t._htmlID,t.start,t.end,t.hueCount,t.satCount,t.valCount)}sample(){let e=(this.end.h-this.start.h)/(this.hueCount-1),t=(this.end.s-this.start.s)/(this.satCount-1),n=(this.end.v-this.start.v)/(this.valCount-1),r=[];for(let a=0;a<this.satCount;a++){let l=Math.round(a*t+this.start.s);for(let i=0;i<this.valCount;i++){let s=Math.round(i*n+this.start.v);for(let o=0;o<this.hueCount;o++){let d=Math.round(o*e+this.start.h);r.push({h:d,v:s,s:l})}}}return r.map(e=>hsv2rgb(e))}createHTML(){let e="sampler-"+this._htmlID,t=document.createElement("tr");t.id=e;let n=[document.createElement("td"),document.createElement("td"),document.createElement("td")];n[0].innerHTML="Hue<br/>Saturation</br>Value",n[0].classList.add("pseudo-th");let r=document.createElement("div");r.classList.add("parameters-tbl");let a=document.createElement("div"),l=[document.createElement("div"),document.createElement("div"),document.createElement("div"),document.createElement("div")];l[1].textContent="Hue",l[2].textContent="Saturation",l[3].textContent="Value",a.append(l[0],l[1],l[2],l[3]),document.createElement("div");let i=[document.createElement("div"),document.createElement("div"),document.createElement("div")],s=[document.createElement("div"),document.createElement("div"),document.createElement("div"),document.createElement("div")];s[0].textContent="Start: ";let o=document.createElement("input");o.type="number",o.id=e+"-start-hue",o.min="0",o.max="360",o.step="1",o.value=this.start.h.toString(),o.onchange=()=>{this.start.h=parseInt(o.value),syncPaletteView()},s[1].appendChild(o);let d=document.createElement("input");d.type="number",d.id=e+"-start-sat",d.min="0",d.max="100",d.step="1",d.value=this.start.s.toString(),d.onchange=()=>{let e=parseInt(d.value);e=Math.min(e=Math.max(e,parseInt(d.min)),parseInt(d.max)),this.start.s=e,d.value=e.toString(),syncPaletteView()},s[2].appendChild(d);let m=document.createElement("input");m.type="number",m.id=e+"-start-val",m.min="0",m.max="100",m.step="1",m.value=this.start.v.toString(),m.onchange=()=>{let e=parseInt(m.value);e=Math.min(e=Math.max(e,parseInt(m.min)),parseInt(m.max)),this.start.v=e,m.value=e.toString(),syncPaletteView()},s[3].appendChild(m);let c=[document.createElement("div"),document.createElement("div"),document.createElement("div"),document.createElement("div")];c[0].textContent="End: ";let p=document.createElement("input");p.type="number",p.id=e+"-end-hue",p.min="0",p.max="360",p.step="1",p.value=this.end.h.toString(),p.onchange=()=>{this.end.h=parseInt(p.value),syncPaletteView()},c[1].appendChild(p);let u=document.createElement("input");u.type="number",u.id=e+"-end-sat",u.min="0",u.max="100",u.step="1",u.value=this.end.s.toString(),u.onchange=()=>{let e=parseInt(u.value);e=Math.min(e=Math.max(e,parseInt(u.min)),parseInt(u.max)),this.end.s=e,u.value=e.toString(),syncPaletteView()},c[2].appendChild(u);let h=document.createElement("input");h.type="number",h.id=e+"-end-val",h.min="0",h.max="100",h.step="1",h.value=this.end.v.toString(),h.onchange=()=>{let e=parseInt(h.value);e=Math.min(e=Math.max(e,parseInt(h.min)),parseInt(h.max)),this.end.v=e,h.value=e.toString(),syncPaletteView()},c[3].appendChild(h);let E=[document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];E[0].textContent="Bands: ";let g=document.createElement("input");g.type="number",g.id=e+"-hues",g.min="1",g.max="99",g.step="1",g.value=this.hueCount.toString(),g.onchange=()=>{let e=parseInt(g.value);e=Math.min(e=Math.max(e,parseInt(g.min)),parseInt(g.max)),this.hueCount=e,g.value=e.toString(),syncPaletteView()},E[1].appendChild(g);let $=document.createElement("input");$.type="number",$.id=e+"-sats",$.min="1",$.max="99",$.step="1",$.value=this.satCount.toString(),$.onchange=()=>{let e=parseInt($.value);e=Math.min(e=Math.max(e,parseInt($.min)),parseInt($.max)),this.satCount=e,$.value=e.toString(),syncPaletteView()},E[2].appendChild($);let b=document.createElement("input");return b.type="number",b.id=e+"-vals",b.min="1",b.max="99",b.step="1",b.value=this.valCount.toString(),b.onchange=()=>{let e=parseInt(b.value);e=Math.min(e=Math.max(e,parseInt(b.min)),parseInt(b.max)),this.valCount=e,b.value=e.toString(),syncPaletteView()},E[3].appendChild(b),a.append(l[0],l[1],l[2],l[3]),i[0].append(s[0],s[1],s[2],s[3]),i[1].append(c[0],c[1],c[2],c[3]),i[2].append(E[0],E[1],E[2],E[3]),r.append(a,i[0],i[1],i[2]),n[1].appendChild(r),t.append(n[0],n[1],n[2]),t}}function getColorsFrom(e){let t=[];return e.forEach(e=>{t=t.concat(e.sample())}),t}function getSamplers(){return g_samplers}function setSamplers(e){g_samplers=e}function genSamplerID(){return++g_accumulator}function resetSamplers(){g_samplers=[],g_accumulator=0;let e=document.getElementById("properties");e.innerHTML=""}function removeDuplicates(e){let t=[];return e.forEach(e=>{let n=t.find(t=>{let n=e.r==t.r&&e.g==t.g&&e.b==t.b;return n});n||t.push(e)}),t}